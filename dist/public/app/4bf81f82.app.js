"use strict";function hourDiff(a,b){return a=a.substring(6,8),b=b.substring(6,8),b-a}angular.module("solarWindowApp",["ngCookies","ngResource","ngSanitize","ngRoute","btford.socket-io","ui.bootstrap","chart.js"]).config(["$routeProvider","$locationProvider",function(a,b){a.otherwise({redirectTo:"/"}),b.html5Mode(!0)}]),Date.prototype.addHours=function(a){return this.setHours(this.getHours()+a),this},angular.module("solarWindowApp").controller("HistoryCtrl",["$scope","$http","socket",function(a,b,c){a.volts=[],a.amps=[],a.powers=[],a.date=[],a.dateformat=[],b.get("/api/powerdatas").success(function(b){a.SolarDatas=b;for(var d=0;d<b.length;d++)a.volts.push(b[d].volt),a.amps.push(b[d].amp),a.powers.push(b[d].power),a.date.push(b[d].date),a.dateformat.push(b[d].date.substring(8,10)+"/"+b[d].date.substring(5,7)+" "+b[d].date.substring(11,16));c.syncUpdates("powerdata",a.SolarDatas,function(b,c){a.volts.push(c.volt),a.amps.push(c.amp),a.powers.push(c.power),a.date.push(c.date),a.dateformat.push(c.date.substring(8,10)+"/"+c.date.substring(5,7)+" "+c.date.substring(11,16))})}),a.addAll=function(){var a={date:(new Date).addHours(-4),volt:20,amp:1,power:20};b.post("/api/powerdatas",a);var c={date:(new Date).addHours(-3),volt:20,amp:1.5,power:30};b.post("/api/powerdatas",c);var d={date:(new Date).addHours(-2),volt:20,amp:2,power:40};b.post("/api/powerdatas",d);var e={date:(new Date).addHours(-1),volt:20,amp:1,power:20};b.post("/api/powerdatas",e);var f={date:(new Date).toUTCString(),volt:20,amp:1.5,power:30};b.post("/api/powerdatas",f)},a.addAll(),a.colors=["#FD1F5E","#1EF9A1","#7FFD1F","#68F000"],a.labels=a.dateformat,a.series=["Volts","Amps","Power"],a.data=[a.volts,a.amps,a.powers];var d=0;a.onClick=function(b){var c;if(2===d)d=0,a.showStats=!1,a.showDatas=!1,a.periodVolt=0,a.periodAmp=0,a.periodPower=0,a.kwh=0;else if(0===d)a.showStats=!0,a.dateStart=b[0].label,a.periodStart=a.dateStart,a.period=a.periodStart,d++,a.pos1=a.SolarDatas.map(function(a){return a.date.substring(8,10)+"/"+a.date.substring(5,7)+" "+a.date.substring(11,16)}).indexOf(b[0].label);else{c=b[0].label,a.periodEnd=c,a.period=a.periodStart+" to "+a.periodEnd,d++,a.periodVolt=0,a.periodAmp=0,a.periodPower=0;for(var e=a.pos1;e<=a.SolarDatas.map(function(a){return a.date.substring(8,10)+"/"+a.date.substring(5,7)+" "+a.date.substring(11,16)}).indexOf(b[0].label);e++)a.periodVolt+=parseFloat(a.SolarDatas[e].volt),a.periodPower+=parseFloat(a.SolarDatas[e].power),e===a.SolarDatas.map(function(a){return a.date.substring(8,10)+"/"+a.date.substring(5,7)+" "+a.date.substring(11,16)}).indexOf(b[0].label)&&(a.periodVolt=a.periodVolt/(e-a.pos1+1),a.periodPower=a.periodPower/(e-a.pos1+1),a.periodAmp=a.periodPower/a.periodVolt,a.showDatas=!0,a.timediff=hourDiff(a.dateStart,c),a.power=a.periodVolt*a.periodAmp,a.kwh=a.power*a.timediff/1e3)}}}]),angular.module("solarWindowApp").config(["$routeProvider",function(a){a.when("/history",{templateUrl:"app/history/history.html",controller:"HistoryCtrl"})}]),angular.module("solarWindowApp").controller("InstantCtrl",["$scope","$http","socket",function(a,b,c){function d(){for(var a="0123456789ABCDEF".split(""),b="#",c=0;6>c;c++)b+=a[Math.floor(16*Math.random())];return{color:b,"border-color":b}}a.$on("$routeChangeSuccess",function(a,c,d){b.get("/api/instantdatas/rtmon")}),window.onbeforeunload=function(){b.get("/api/instantdatas/rtmoff")},a.$on("$routeChangeStart",function(a,c,d){b.get("/api/instantdatas/rtmoff")});var e;b.get("/api/instantdatas").success(function(b){a.SolarDatas=b,a.message=[];for(var f=b.length-1;f>=b.length-11;f--)b[f].date=b[f].date.substring(8,10)+"/"+b[f].date.substring(5,7)+" "+b[f].date.substring(11,16),e=d(),a.message.push({date:b[f].date,message:b[f].message,color:e});c.syncUpdates("instantData",a.SolarDatas,function(b,c,f){var g=c.message.substring(0,4);"RTM:"===g&&(a.InstaVolt=c.message.substring(c.message.indexOf("V")-5,c.message.indexOf("V")),a.InstaAmp=c.message.substring(c.message.indexOf("A")-4,c.message.indexOf("A")),a.InstaPower=(a.InstaVolt*a.InstaAmp).toFixed(2)),c.date=c.date.substring(8,10)+"/"+c.date.substring(5,7)+" "+c.date.substring(11,16),e=d(),a.message.push({date:c.date,message:c.message,color:e})})}),a.blindUp=function(){b.get("/api/instantdatas/blindup")},a.blindDown=function(){b.get("/api/instantdatas/blinddown")},a.localOpt=function(){b.get("/api/instantdatas/locopt")},a.globalOpt=function(){b.get("/api/instantdatas/globopt")},a.formatDate=function(a){var b=new Date(a);return b}}]),angular.module("solarWindowApp").config(["$routeProvider",function(a){a.when("/instant",{templateUrl:"app/instant/instant.html",controller:"InstantCtrl"})}]),angular.module("solarWindowApp").controller("MainCtrl",["$scope","$http","$location","socket",function(a,b,c,d){a.go=function(a){c.path(a)}}]),angular.module("solarWindowApp").config(["$routeProvider",function(a){a.when("/",{templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("solarWindowApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("solarWindowApp").controller("NavbarCtrl",["$scope","$location",function(a,b){a.menu=[{title:"Home",link:"/"}],a.isCollapsed=!0,a.isActive=function(a){return a===b.path()}}]),angular.module("solarWindowApp").factory("socket",["socketFactory",function(a){var b=io("",{path:"/socket.io-client"}),c=a({ioSocket:b});return{socket:c,syncUpdates:function(a,b,d){d=d||angular.noop,c.on(a+":save",function(a){var c=_.find(b,{_id:a._id}),e=b.indexOf(c),f="created";c?(b.splice(e,1,a),f="updated"):b.push(a),d(f,a,b)}),c.on(a+":remove",function(a){var c="deleted";_.remove(b,{_id:a._id}),d(c,a,b)})},unsyncUpdates:function(a){c.removeAllListeners(a+":save"),c.removeAllListeners(a+":remove")}}}]),angular.module("solarWindowApp").run(["$templateCache",function(a){a.put("app/history/history.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><!-- Volts:\n<input type="text" ng-model="dataSend.volt" />\nAmp:\n<input type="text" ng-model="dataSend.amp" />\n<button ng-click="addData(dataSend)">Add</button>\n<button ng-click="addAll()">Add All</button> --><div class=container><canvas id=line class="chart chart-line" chart-data=data chart-labels=labels chart-legend=true chart-series=series chart-click=onClick chart-colours=colors></canvas><div class=container ng-show=showStats><div class=datas><p><b>Period :</b> {{period}}</p><div ng-show=showDatas>({{timediff}} hours)<table class=center><tr><td><h1 class=volts>{{periodVolt}} V</h1></td><td><h1 class=amps>{{periodAmp}} A</h1></td><td><h1 class=power>{{power}} W</h1></td></tr><tr><td></td><td><h1 class=pwh>{{kwh}} kwh</h1></td></tr></table></div></div></div></div>'),a.put("app/instant/instant.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=special><div class=jumbotron><div class=row><div class="col-md-4 console img-rounded"><table class=tabconsole><tr ng-repeat="item in message | limitTo: -10 track by $index" class=item-checked><td class=morehalf ng-style=item.color>{{item.date}}</td><td class=morehalf ng-style=item.color>-----</td><td class=full ng-style=item.color><div class=message><b>{{item.message}}</b></div></td></tr></table></div><div class=col-md-4><h1>Datas</h1><div class=row><div class="col-md-6 volts"><h1>{{InstaVolt}} Volts</h1></div><div class="col-md-6 amps"><h1>{{InstaAmp}} Amps</h1></div></div><div class="row power"><h1>{{InstaPower}} Watts</h1></div></div><div class=col-md-4><h1>Control</h1><h2>Window Status :</h2><div class=row><button class="btn btn-xl btn-success top-buffer-xl" ng-click=blindUp()>Up</button></div><div class=row><button class="btn btn-xl btn-success top-buffer" ng-click=blindDown()>Down</button></div><div class=col-md-6><button class="btn btn-xl btn-info top-buffer-xl" ng-click=localOpt()>Find local Optimum</button></div><div class=col-md-6><button class="btn btn-xl btn-info top-buffer-xl" ng-click=globalOpt()>Find global Optimum</button></div></div></div></div></div>'),a.put("app/main/main.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><header class=hero-unit id=banner><div class=container><h1>Enerblinds</h1><p class=lead>Tracking and Management Platform</p><img src=assets/images/a03f63bc.fsm.png alt="I\'m Yeoman"></div></header><hr><div class=container><div class="btn-toolbar text-center"><button class="btn btn-success btn-xl" ng-click="go(\'/instant\')">Instant Production</button> <button class="btn btn-success btn-xl" ng-click="go(\'/history\')">Production History</button></div><!-- <div class="row">\r\n    <div class="col-lg-12">\r\n      <h1 class="page-header">Features:</h1>\r\n      <ul class="nav nav-tabs nav-stacked col-md-4 col-lg-4 col-sm-6" ng-repeat="thing in awesomeThings">\r\n        <li><a href="#" tooltip="{{thing.info}}">{{thing.name}}<button type="button" class="close" ng-click="deleteThing(thing)">&times;</button></a></li>\r\n      </ul>\r\n    </div>\r\n  </div> --><!-- <form class="thing-form">\r\n    <label>Syncs in realtime across clients</label>\r\n    <p class="input-group">\r\n      <input type="text" class="form-control" placeholder="Add a new thing here." ng-model="newThing">\r\n      <span class="input-group-btn">\r\n        <button type="submit" class="btn btn-primary" ng-click="addThing()">Add New</button>\r\n      </span>\r\n    </p>\r\n  </form> --></div><footer class=footer><div class=container>Enerblinds v0.1a | <a href=https://github.com/haplo31/SolarWindow>GitHub</a></div></footer>'),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller=NavbarCtrl><div class=container><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="/" class=navbar-brand>solar-window</a></div><div collapse=isCollapsed class="navbar-collapse collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-repeat="item in menu" ng-class="{active: isActive(item.link)}"><a ng-href={{item.link}}>{{item.title}}</a></li></ul></div></div></div>')}]);